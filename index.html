<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 Á´ãÂ±±ÈªëÈÉ® & Âè§Â∑ùÁ•≠ | Pro Êï¥ÂêàÁâà V59</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#09090b', 
                        surface: '#18181b', 
                        surfaceLight: '#27272a', 
                        primary: '#38bdf8', 
                        primaryDim: '#0284c7', 
                        textMain: '#fafafa', 
                        textSub: '#a1a1aa', 
                        accent: '#fbbf24', 
                        danger: '#f87171', 
                        food: '#f97316', 
                        border: '#27272a', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    boxShadow: {
                        'glow-primary': '0 0 20px -5px rgba(56, 189, 248, 0.25)',
                        'glow-accent': '0 0 20px -5px rgba(251, 191, 36, 0.25)',
                        'glow-food': '0 0 20px -5px rgba(249, 115, 22, 0.25)',
                    }
                }
            }
        }
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #09090b;
            color: #fafafa;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        
        .app-card {
            background: linear-gradient(145deg, #18181b 0%, #09090b 100%);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid #27272a;
            position: relative;
            overflow: hidden;
        }

        .app-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        }
        
        .task-box {
            background: linear-gradient(to right, rgba(56, 189, 248, 0.1), transparent);
            border-left: 3px solid #38bdf8;
        }

        .alert-box {
            background: linear-gradient(to right, rgba(248, 113, 113, 0.1), transparent);
            border-left: 3px solid #f87171;
        }

        .festival-box {
             background: linear-gradient(to right, rgba(251, 191, 36, 0.1), transparent);
             border-left: 3px solid #fbbf24;
        }

        .food-box {
             background: linear-gradient(to right, rgba(249, 115, 22, 0.08), transparent);
             border-left: 3px solid #f97316;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.98) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .animate-card {
            animation: fadeInScale 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Toast */
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #38bdf8; color: #09090b; padding: 8px 16px; border-radius: 99px;
            font-size: 12px; font-weight: bold; z-index: 100;
            box-shadow: 0 4px 12px rgba(56,189,248,0.3);
            transition: opacity 0.3s;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const CONFIG = { weatherApiBase: "https://archive-api.open-meteo.com/v1/archive" };

        const COUPONS_DATA = [
            { "name": "DonkiÂîêÂêâË®∂Âæ∑", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÂÜçÊäò5%", "expiry": "ÁÑ°ÊúüÈôê", "final_url": "https://japanportal.donki-global.com/coupon/?ptcd=0076003303", "tags": ["ÈõúË≤®", "Ê∑±Â§ú"] },
            { "name": "Bic Camera", "discount": "ÊªøÈ°çÂÖçÁ®ÖÔºåÊúÄÈ´òÂÜçÊäò7%", "expiry": "2026/8/31", "final_url": "https://www.funtime.com.tw/travelstore/coupon/BicCamera_251217.png", "tags": ["ÈõªÂô®", "Ëó•Â¶ù"] },
            { "name": "Salonia", "discount": "Êäò5%(ËàáBic Camera‰ΩµÁî®)", "expiry": "2026/4/30", "final_url": "https://www.funtime.com.tw/travelstore/coupon/BicCamera_251217.png", "tags": ["ÈõªÂô®", "ÁæéÂÆπ"] },
            { "name": "ÊÑõÈõªÁéãEdion", "discount": "ÊúÄÈ´òÂÖçÁ®Ö+7%", "expiry": "2026/12/31", "final_url": "https://www.funtime.com.tw/travelstore/coupon/edion2025.jpg", "tags": ["ÈõªÂô®"] },
            { "name": "ÊàêÁî∞ÂÖçÁ®ÖÂ∫ó", "discount": "95ÊäòÂÑ™ÊÉ†", "expiry": "2026/3/31", "final_url": "https://duty-free-japan.jp/narita/ta/content/coupon2833-30.html", "tags": ["ÂÖçÁ®ÖÂ∫ó", "Ê©üÂ†¥"] },
            { "name": "SUNDRUG", "discount": "ÊúÄÈ´òÂÖçÁ®Ö+7%", "expiry": "ÁÑ°ÊúüÈôê", "final_url": "https://www.funtime.com.tw/travelstore/coupon/sundrug%20_funtime.jpg", "tags": ["Ëó•Â¶ù"] },
            { "name": "ÂêçÈêµÁôæË≤®", "discount": "ÂÖçÁ®Ö+5%", "expiry": "2026/2/28", "final_url": "https://www.funtime.com.tw/travelstore/coupon/meitetsu_250516.png", "tags": ["ÁôæË≤®", "ÂêçÂè§Â±ã"] }
        ];

        // V59 Integrated Buffer Times & Navigation Tips
        const ITINERARY_DATA = [
            {
                id: 1, date: "2026-04-15", displayDate: "4/15 (‰∏â)", title: "ÊäµÈÅîÊù±‰∫¨", city: "Êù±‰∫¨ (Tokyo)", lat: 35.6895, lon: 139.6917,
                planA: [
                    { time: "20:30", title: "ÊäµÈÅîÊàêÁî∞Ê©üÂ†¥ (NRT)", type: "flight", detail: "ÂÖ•Â¢ÉÈ†êË®à 1hr„ÄÇÂª∫Ë≠∞Ê©ü‰∏äÂÖàÂ°´Â•Ω Visit Japan Web QR Code„ÄÇ" },
                    { time: "21:30 - 22:15", title: "Skyliner ÂæÄ‰∏äÈáé/È∂ØË∞∑", type: "transport", detail: "Skyliner Ëá≥‰∫¨Êàê‰∏äÈáéÁ´ô (45ÂàÜ)„ÄÇ\nËΩâ‰πò JR Â±±ÊâãÁ∑ö Ëá≥ È∂ØË∞∑Á´ô (1Á´ô)„ÄÇ", cost: "¬•2,570" },
                    { time: "23:00", title: "ÂÖ•‰ΩèÊù±Ê®™INNÈ∂ØË∞∑ÈßÖÂâç", type: "hotel", detail: "Check-in ÊîæË°åÊùé„ÄÇÈ£ØÂ∫óÂ∞±Âú®È∂ØË∞∑Á´ôÂåóÂè£Ê≠•Ë°å 2 ÂàÜÈêò„ÄÇ", address: "Êù±‰∫¨ÈÉΩÂè∞Êù±Âå∫Ê†πÂ≤∏1-4-1" },
                    { time: "‚ö†Ô∏è Áù°Ââç‰ªªÂãô", title: "Â°´ÂØ´ÂÆÖÊÄ•‰æøÈÅãÂñÆ", type: "task", detail: "ÂêëÊ´ÉÊ™ØÁ¥¢ÂèñÈÅãÂñÆÔºåÂØÑÂæÄ„ÄêÊù±Ê®™INNÈáëÊ≤¢ÂÖºÂÖ≠ÂúíÈ¶ôÊûóÂùä„Äë„ÄÇ\nÊåáÂÆöÊäµÈÅîÊó•Ôºö4/17 (ÂæåÂ§©)„ÄÇ" }
                ], planB: null
            },
            {
                id: 2, date: "2026-04-16", displayDate: "4/16 (Âõõ)", title: "Êù±‰∫¨ -> Èï∑ÈáéÂ§ßÁî∫", city: "Èï∑Èáé (Nagano)", lat: 36.6485, lon: 138.1942,
                planA: [
                    { time: "08:30", title: "„ÄêÂØÑË°åÊùé„ÄëÂéªÈáëÊæ§", type: "task", detail: "È£ØÂ∫óÊ´ÉÊ™ØÂØÑÂá∫Â§ßÂñº„ÄÇ‰ªäÂ§©Ëµ∑Âè™ËÉåÂ∞èËÉåÂåÖ (1ÊôöË°£Áâ©)ÔºåÊ∫ñÂÇôÂ±±ÂçÄË°åËªçÔºÅ", address: "Áü≥Â∑ùÁúåÈáëÊ≤¢Â∏ÇÈ¶ôÊûóÂùä2-2-5" },
                    { time: "09:00 - 12:00", title: "‰∏äÈáéË≥ºÁâ© & Êó©ÂçàÈ§ê", type: "food", detail: "È∂ØË∞∑Âéª‰∏äÈáéÂè™Ë¶Å 2 ÂàÜÈêò„ÄÇÈòøÁæéÊ©´‰∏ÅÊúÄÂæåË£úË≤®Èõ∂È£ü„ÄÇ", highlight: true,
                      recs: [
                          {n: "Áâõ„Åã„Å§ „ÇÇ„Å®Êùë", t: "ÁÇ∏ÁâõÊéí", desc: "Ëá™ÁÖéÈÖ•ËÑÜÁÇ∏ÁâõÊéíÔºåÁÑ°Êµ∑ÈÆÆ"},
                          {n: "ËÇâ‰πãÂ§ßÂ±±", t: "ÂíåÁâõÂèØÊ®ÇÈ§Ö", desc: "ÈòøÁæéÊ©´‰∏ÅÊéíÈöäÁæéÈ£ü"}
                      ]
                    },
                    { time: "12:30 - 14:03", title: "Êñ∞ÂππÁ∑ö Hakutaka 563Ëôü", type: "transport", detail: "‰∏äÈáéÁ´ô ‚ûî Èï∑ÈáéÁ´ô„ÄÇ\n‰∏äÈáéÊñ∞ÂππÁ∑öÊúàÂè∞Âú®Âú∞Â∫ïÊ∑±ËôïÔºåÂª∫Ë≠∞ 12:10 Â∞±Ë¶ÅÂà∞Á´ôÊúàÂè∞Á≠âÂÄô„ÄÇ", cost: "¬•8,000" },
                    { time: "14:03 - 14:30", title: "üö∂ ËΩâËªäÊåáÂºïÔºöÈï∑ÈáéÁ´ô", type: "task", detail: "„Äê27ÂàÜÈêòÁ∑©Ë°ù„Äë\n1. ‰∏ãËªäÂæå‰∏äÊ®ìÂá∫Êñ∞ÂππÁ∑öÈñòÂè£„ÄÇ\n2. Êâæ„ÄåÊù±Âè£ (East Exit)„ÄçÊåáÊ®ô„ÄÇ\n3. ‰∏ãÊâ∂Ê¢ØÂà∞ 1 Ê®ìÊâæÂà∞„Äê25 ËôüÊúàÂè∞„Äë„ÄÇ", highlight: true },
                    { time: "14:30 - 15:50", title: "Alpico ÁâπÊÄ•Â∑¥Â£´ (Â∞æÁè≠)", type: "alert", detail: "Èï∑ÈáéÁ´ôÊù±Âè£ 25ËôüÊúàÂè∞ ‚ûî Â§ßÁî∫Ê∫´Ê≥âÈÑâ„ÄÇ\nüö® Ê≥®ÊÑèÔºöÊò•Â≠£Áõ¥ÈÅîÂ∑¥Â£´ÊúÄÈÅ≤ 14:30 ÈñãÂá∫ÔºåÁµïÂ∞çÂîîÂèØ‰ª•ÈåØÈÅéÔºÅ", cost: "¬•2,600" },
                    { time: "16:00 - 18:00", title: "Â§ßÁî∫Ê∫´Ê≥âÈÑâÊï£Á≠ñ", type: "spot", detail: "ÂÖ•‰Ωè„ÄêÁπîËä±„ÄëÂæåÔºö\n1. Ëó•Â∏´Â†ÇÊï£Á≠ñÔºöÊ£ÆÊûóÁ≥ªÁæéÊãç\n2. Ê£ÆÊûóË∂≥ÊπØÔºöÁúãÊÆòÈõ™Ê≥°ËÖ≥",
                      recs: [
                          {n: "Âæ°Ááí (Oyaki)", t: "‰ø°Â∑ûÂêçÁâ©", desc: "ÁÉ§È∫µÈ§ÖÂåÖÈáéËèúÔºåÁµïÁÑ°Êµ∑ÈÆÆ"},
                          {n: "Ê∏ÖÈÖíÂçöÁâ©È§®", t: "ÊôØÈªû", desc: "Ë≤∑Èï∑ÈáéÂú∞ÈÖíÂ•ΩÂéªËôï"}
                      ]
                    },
                    { time: "18:30", title: "ÂÖ•‰ΩèÁπîËä±ÔºöÊá∑Áü≥ÊñôÁêÜ", type: "hotel", detail: "‰∫´ÂèóÊ∫´Ê≥âËàá‰ø°Â∑ûËÇâÊñôÁêÜÊôöÈ§ê„ÄÇÊó©Áù°Ê∫ñÂÇôÊòéÊó• 07:00 ÁôªÂ±±„ÄÇ" }
                ], 
                planB: [
                    { time: "09:00 - 15:00", title: "Êù±‰∫¨ Shopping ÊñπÊ°à", type: "shop", detail: "Â¶ÇÊûúÊÇ®Ë¶ÅÁïôÂà∞‰∏ãÂçà 3 ÈªûÔºåË´ãÊ≥®ÊÑè Plan B ÁöÑÊ•µÈôêËΩâËªäÈ¢®Èö™„ÄÇ" },
                    { time: "15:30 - 17:03", title: "Êñ∞ÂππÁ∑öÂæÄÈï∑Èáé", type: "transport", detail: "‰∏äÈáé ‚ûî Èï∑Èáé„ÄÇ" },
                    { time: "17:03 - 17:11", title: "üèÉ Ê•µÈôêËΩâ‰πò (8ÂàÜÈêò)", type: "alert", detail: "üö® Ë≠¶ÂëäÔºöÈúÄÂú® 8 ÂàÜÈêòÂÖßÂá∫Êñ∞ÂππÁ∑öÈñòÂè£‰∏¶Ë°ùÈÄ≤ JR ÈñòÂè£Êâæ„ÄåÁâπÊÄ•‰ø°ÊøÉËôü„ÄçÊúàÂè∞ÔºÅ", highlight: true },
                    { time: "17:11 - 19:25", title: "ËΩâ‰πò JR ÂÖúÂ§ßÂúàÂÖ•Â§ßÁî∫", type: "transport", detail: "Èï∑Èáé ‚ûî ÊùæÊú¨ ‚ûî ‰ø°ÊøÉÂ§ßÁî∫ ‚ûî ÁöÑÂ£´ ‚ûî ÁπîËä±„ÄÇ" }
                ]
            },
            {
                id: 3, date: "2026-04-17", displayDate: "4/17 (‰∫î)", title: "Á©øË∂äÈõ™‰πãÂ§ßË∞∑", city: "Á´ãÂ±± (Alpine)", lat: 36.5833, lon: 137.6, note: "ÈñãÂ±±Á¨¨‰∫åÊó•",
                planA: [
                    { time: "07:30", title: "Â∑¥Â£´ÂâçÂæÄÊâáÊæ§Á´ô", type: "transport", detail: "ÂæûÂ§ßÁî∫Âá∫ÁôºÂâçÂæÄÁ©øË∂äË∑ØÁ∑öËµ∑Èªû„ÄÇÂª∫Ë≠∞È£ØÂ∫óÊó©È§êÂæåÂç≥Âá∫Áôº„ÄÇ" },
                    { time: "08:30 - 15:30", title: "ÈòøÁàæÂçëÊñØË∑ØÁ∑ö (ÂÖ®Á®ã)", type: "transport", detail: "ÊâáÊæ§ ‚ûî ÈªëÈÉ®Ê∞¥Â£© ‚ûî ÂÆ§Â†Ç ‚ûî ÁæéÂ•≥Âπ≥ ‚ûî Á´ãÂ±±Á´ô„ÄÇ\nÂêÑÈªûËΩâËªäÁî±Â∑•‰Ωú‰∫∫Âì°Â∞éÂºïÔºå‰∫∫ÊµÅÂ§ßÊôÇÈúÄÊéíÈöä„ÄÇ", cost: "Â•óÁ•®" },
                    { time: "10:30 - 12:30", title: "ÂÆ§Â†Ç„ÉªÈõ™‰πãÂ§ßË∞∑", type: "spot", detail: "Êµ∑Êãî 2450m„ÄÇÊº´Ê≠• 20 Á±≥È´òÈõ™Â£Å„ÄÇË®òÂæóÂ∏∂Â¢®Èè°Èò≤Èõ™Áõ≤„ÄÇ", highlight: true },
                    { time: "13:00", title: "Â±±È†ÇÂçàÈ§ê (ÁÑ°Êµ∑ÈÆÆ)", type: "food",
                      recs: [
                          {n: "ÂÆ§Â†ÇÈ§êÂª≥", t: "ÈªëÈÉ®Ë±öËÇâÊãâÈ∫µ", desc: "Êµ∑ÊãîÊúÄÈ´òÊãâÈ∫µÂ∫ó"},
                          {n: "ÊâáÊæ§ Rest House", t: "ÈªëÈÉ®Ê∞¥Â£©ÂíñÂì©", desc: "ÈÄ†ÂûãÁâπËâ≤ÔºåÁÑ°Êµ∑ÈÆÆÊàêÂàÜ"}
                      ]
                    },
                    { time: "17:30 - 18:00", title: "Êñ∞ÂππÁ∑öÂæÄÈáëÊæ§", type: "transport", detail: "ÂØåÂ±± ‚ûî ÈáëÊæ§„ÄÇÁ¥Ñ 20 ÂàÜÈêò„ÄÇ", cost: "¬•2,860" },
                    { time: "18:30", title: "ÂÖ•‰ΩèÊù±Ê®™INNÈáëÊ≤¢ÂÖºÂÖ≠ÂúíÈ¶ôÊûóÂùä", type: "hotel", detail: "üéâ È†òÂèñÂ§ßË°åÊùéÔºÅÈ£ØÂ∫óÂ∞±Âú®È¶ôÊûóÂùäÂïÜÂúàÔºåÊôöÈ§êÈÅ∏ÊìáÊ•µÂ§ö„ÄÇ" }
                ], planB: null
            },
            {
                id: 4, date: "2026-04-18", displayDate: "4/18 (ÂÖ≠)", title: "ÈáëÊæ§Ë≥ûÊ´ªËàáÂ∞è‰∫¨ÈÉΩ", city: "ÈáëÊæ§ (Kanazawa)", lat: 36.5613, lon: 136.6562,
                planA: [
                    { time: "09:00 - 11:30", title: "ÂÖºÂÖ≠Âúí & ÈáëÊæ§ÂüéÂÖ¨Âúí üå∏", type: "spot", detail: "ÂæûÈ£ØÂ∫óÊ≠•Ë°å 5 ÂàÜÈêòÂç≥ÈÅî„ÄÇ4Êúà‰∏≠Êó¨Ê•µÈ´òÊ©üÁéáÊ´ªÂêπÈõ™„ÄÇ", highlight: true },
                    { time: "11:45 - 13:00", title: "ËøëÊ±üÁî∫Â∏ÇÂ†¥ÂçàÈ§ê (ËÇâÈ£ü)", type: "food", detail: "Â∏ÇÂ†¥Èô§‰∫ÜÊµ∑ÈÆÆÔºåËÉΩÁôªÁâõ‰πüÊ•µÂá∫ÂêçÔºÅ", 
                      recs: [
                          {n: "ËÉΩÁôªÁâõ Â£ΩÂè∏/‰∏≤Ááí", t: "A5ÂíåÁâõ", desc: "ÁèæÂ†¥ÁÇôÁáíÔºåÂÖ•Âè£Âç≥Âåñ"},
                          {n: "ÈáëÊæ§ÂÜ†ËªçÂíñÂì©", t: "ÈªëÂíñÂì©Ë±¨Êéí", desc: "Âú®Âú∞ÊøÉÂéöÈªëÂíñÂì©"}
                      ]
                    },
                    { time: "18:00 - 19:00", title: "Êà∞Ë°ìÁßªÂãï (ÊèõÈ£ØÂ∫ó)", type: "task", detail: "ÂèñË°åÊùéÊê≠ÂÖ¨ËªäÁßªÈò≤Ëá≥„ÄêÈáëÊæ§Á´ôÊù±Âè£„Äë‰ΩèÂÆøÔºåÁÇ∫ÊòéÊó©Êê≠Â∑¥Â£´ÂÅöÊ∫ñÂÇô„ÄÇ" },
                    { time: "19:30", title: "ÂÖ•‰ΩèÊù±Ê®™INNÈáëÊ≤¢ÈßÖÊù±Âè£", type: "hotel", detail: "Check-in„ÄÇÊôöÈ§êÂ∞±Âú®ËªäÁ´ô„ÄåÈáëÊæ§ÁôæÁï™Ë°ó„ÄçÂêÉÊãâÈ∫µÊàñÈóúÊù±ÁÖÆ„ÄÇ", highlight: true }
                ], planB: null
            },
            {
                id: 5, date: "2026-04-19", displayDate: "4/19 (Êó•)", title: "È´òÂ±±Ë≥ûÊ´ª & Âè§Â∑ùÁ•≠", city: "È´òÂ±±/Âè§Â∑ù", lat: 36.1408, lon: 137.2513, note: "Âè§Â∑ùÁ•≠Ê≠£Êó•",
                planA: [
                    { time: "08:10 - 10:25", title: "ÊøÉÈ£õÂ∑¥Â£´ÂæÄÈ´òÂ±±", type: "transport", detail: "„ÄêÈúÄÈ†êÁ¥Ñ„ÄëÂ∏∂ËëóÂ§ßÂñºÊê≠Â∑¥Â£´„ÄÇ1 ËôüÊúàÂè∞ÂÄôËªä„ÄÇ", cost: "¬•3,600" },
                    { time: "10:30", title: "ÈÖíÂ∫óÊîæ‰ΩéÂ§ßÂñº", type: "task", detail: "ÊäµÈÅîÈ´òÂ±±ÂæåÔºåÁ´ãÂàªÈÅéÂ∞çÈù¢È¶¨Ë∑ØÂâçÂæÄ Residence Hotel ÊîæË°åÊùéÔºåÂè™ÈúÄË°å 2 ÂàÜÈêòÔºÅ", address: "Â≤êÈòúÁúåÈ´òÂ±±Â∏ÇËä±ÈáåÁî∫6‰∏ÅÁõÆ105" },
                    { time: "11:00 - 13:00", title: "È´òÂ±±ËÄÅË°óË≥ûÊ´ª üå∏", type: "food", detail: "‰∏≠Ê©ãËàáÂÆÆÂ∑ùÊ≤≥ÁïîÊ´ªËä±ÁµïÊôØ„ÄÇ", highlight: true,
                      recs: [
                          {n: "KotteÁâõ", t: "È£õÈ©íÁâõÊè°Â£ΩÂè∏", desc: "ÂøÖÊéíÈöäÂêçÂ∫ó"},
                          {n: "Âë≥ËóèÂ§©Âúã", t: "È£õÈ©íÁâõÁáíËÇâ", desc: "È´òÂ±±ÊúÄÂº∑ÂíåÁâõ"}
                      ]
                    },
                    { time: "13:40 - 14:00", title: "JR ÂæÄÈ£õÈ©íÂè§Â∑ù", type: "transport", detail: "JR Â∞±Âú®È£ØÂ∫óÊóÅÈÇäÔºåÈùûÂ∏∏Êñπ‰æø„ÄÇ" },
                    { time: "19:00 - 21:00", title: "üèÆ Âè§Â∑ùÁ•≠ÔºöËµ∑Â§™Èºì", type: "festival", detail: "Ë∂ÖÁ¥öÁÜ±Ë°ÄÔºÅÊ≥®ÊÑèÔºöÂ§úÊôöÊ∫´Â∫¶ÂÉÖÂÄã‰ΩçÊï∏ÔºåÂãôÂøÖÁ©øÁæΩÁµ®ÔºÅ", highlight: true },
                    { time: "21:30", title: "ËøîÂõûÈ´òÂ±±ÈÖíÂ∫ó", type: "hotel", detail: "Êê≠‰πò JR Ëá®ÊôÇÂàóËªäÂõûÈ´òÂ±±„ÄÇËøîÈÖíÂ∫óÊ≠£Âºè Check-in ‰ºëÊÅØ„ÄÇ" }
                ], planB: null
            },
            {
                id: 6, date: "2026-04-20", displayDate: "4/20 (‰∏Ä)", title: "ÂêçÂè§Â±ãË≥ºÁâ©", city: "ÂêçÂè§Â±ã (Nagoya)", lat: 35.1815, lon: 136.9066,
                planA: [
                    { time: "08:00 - 09:30", title: "ÂÆÆÂ∑ùÊúùÂ∏Ç", type: "spot", detail: "Ë≤∑ËòãÊûúÂÅöÊó©È§ê„ÄÇ" },
                    { time: "10:30 - 13:10", title: "ÁâπÊÄ• Hida ÂæÄÂêçÂè§Â±ã", type: "transport", detail: "JR Hida (È£õÈ©íËôü)„ÄÇÂäÉ‰ΩçÂª∫Ë≠∞ÈÅ∏Âè≥ÂÅ¥„ÄÇ", cost: "¬•6,000" },
                    { time: "14:00 - 18:30", title: "Â§ßÈ†à & Ê¶ÆÂïÜÂúà", type: "shop", detail: "ÂêçÂè§Â±ãÊúÄÂæåË°ùÂà∫„ÄÇ" },
                    { time: "19:30", title: "ÂêçÂè§Â±ãÂêçÁâ©ÊôöÈ§ê", type: "food", detail: "Áü¢Â†¥Ë±öÂë≥ÂôåË±¨Êéí Êàñ ‰∏ñÁïå‰πãÂ±±Â∞áÈõûÁøº„ÄÇ", highlight: true },
                    { time: "21:00", title: "ÂÖ•‰ΩèÊù±Ê®™INNÂêçÂè§Â±ãÊ†Ñ", type: "hotel", detail: "Êï¥ÁêÜÊà∞Âà©ÂìÅ„ÄÇÈ£ØÂ∫óÂú®Ê¶ÆÂïÜÂúàÊ†∏ÂøÉ„ÄÇ" }
                ], planB: null
            },
            {
                id: 7, date: "2026-04-21", displayDate: "4/21 (‰∫å)", title: "ÁÜ±Áî∞Á•ûÂÆÆËàáËøîÊ∏Ø", city: "ÂêçÂè§Â±ã (Nagoya)", lat: 35.1815, lon: 136.9066,
                planA: [
                    { time: "10:00 - 11:30", title: "ÁÜ±Áî∞Á•ûÂÆÆ", type: "spot", detail: "ÂèÉÊãúÁ•ûÂäç„ÄÇ" },
                    { time: "12:00 - 13:30", title: "‰∫§Ë∂æÈõûÂçàÈ§ê (Âú∞Èõû)", type: "food", detail: "Áî®ÈõûËÇâ‰∏âÂêÉ‰ª£ÊõøÈ∞ªÈ≠öÈ£Ø„ÄÇ", highlight: true,
                      recs: [
                          {n: "È≥•ÈñãÁ∏ΩÊú¨ÂÆ∂", t: "‰∫§Ë∂æÈõû‰∏âÂêÉ", desc: "ÂêçÂè§Â±ãÂú∞ÈõûÔºåÁÑ°Êµ∑ÈÆÆÈÅéÊïè"},
                          {n: "Â±±Êú¨Â±ãÊú¨Â∫ó", t: "Âë≥ÂôåÁáâÁÉèÂÜ¨", desc: "Ë∂ÖÊøÉÈÉÅÁ¥ÖÂë≥Âôå"}
                      ]
                    },
                    { time: "16:45", title: "üö∂ ËΩâËªäÊåáÂºïÔºöÂêçÈêµÁ´ô", type: "task", detail: "ÂæûÂêçÂè§Â±ãÁ´ôÊ≠•Ë°åËá≥„ÄåÂêçÈêµ (Meitetsu)„ÄçËªäÁ´ôÁ¥ÑÈúÄ 10 ÂàÜÈêòÔºåÂà•Ë∑üËëó JR Ëµ∞„ÄÇ", highlight: true },
                    { time: "17:00 - 17:30", title: "ÂêçÈêµ Œº-SKY ÂæÄÊ©üÂ†¥", type: "transport", detail: "ÂÖ®ËªäÊåáÂÆöÂ∏≠Ôºå28ÂàÜÈêòÁõ¥ÈÅîÊ©üÂ†¥„ÄÇ", cost: "¬•1,250" },
                    { time: "21:00", title: "Ëµ∑È£õËøîÊ∏Ø (HKG)", type: "flight", detail: "ÂÆåÁæéÁµêÊùüÔºÅ" }
                ], planB: null
            }
        ];

        // --- UI Components ---
        const IconWrapper = ({ name, className = "w-5 h-5" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const CopyButton = ({ text, onCopy }) => (
            <button onClick={(e) => { e.stopPropagation(); navigator.clipboard.writeText(text).then(onCopy); }}
                className="ml-2 inline-flex items-center gap-1 bg-zinc-800 hover:bg-sky-900/50 text-sky-400 px-2 py-1 rounded text-[10px] font-bold transition-colors border border-zinc-700"
            >
                <IconWrapper name="copy" className="w-3 h-3" /> Ë§áË£Ω
            </button>
        );

        const WeatherWidget = ({ lat, lon, date }) => {
            const [weather, setWeather] = useState(null);
            useEffect(() => {
                const fetchWeather = async () => {
                    const targetYear = 2025;
                    const [y, m, d] = date.split('-');
                    try {
                        const res = await fetch(`${CONFIG.weatherApiBase}?latitude=${lat}&longitude=${lon}&start_date=${targetYear}-${m}-${d}&end_date=${targetYear}-${m}-${d}&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo`);
                        const data = await res.json();
                        if (data.daily) setWeather({ code: data.daily.weather_code[0], max: data.daily.temperature_2m_max[0], min: data.daily.temperature_2m_min[0] });
                    } catch (e) { console.error(e); }
                };
                if (lat && lon) fetchWeather();
            }, [lat, lon, date]);
            if (!weather) return <div className="text-xs text-zinc-500 animate-pulse">...</div>;
            return (
                <div className="flex items-center gap-1.5 bg-zinc-900/80 backdrop-blur px-3 py-1.5 rounded-full border border-zinc-800 shadow-sm">
                    <IconWrapper name={weather.code <= 3 ? "sun" : "cloud"} className="w-3.5 h-3.5 text-sky-400" />
                    <span className="font-bold text-xs text-zinc-200">{weather.max}¬∞</span>
                </div>
            );
        };

        const ItineraryView = () => {
            const [currentDayIdx, setCurrentDayIdx] = useState(0);
            const [activePlans, setActivePlans] = useState({});
            const [toast, setToast] = useState('');
            const day = ITINERARY_DATA[currentDayIdx];
            const isPlanB = activePlans[day.id] === 'B';
            const currentPlan = isPlanB ? (day.planB || day.planA) : day.planA;
            const togglePlan = () => setActivePlans(prev => ({ ...prev, [day.id]: prev[day.id] === 'B' ? 'A' : 'B' }));
            const showToast = (msg) => { setToast(msg); setTimeout(() => setToast(''), 2000); };
            
            const handlePrevDay = () => { if (currentDayIdx > 0) setCurrentDayIdx(currentDayIdx - 1); };
            const handleNextDay = () => { if (currentDayIdx < ITINERARY_DATA.length - 1) setCurrentDayIdx(currentDayIdx + 1); };

            return (
                <div className="h-full flex flex-col pb-20">
                    {toast && <div className="toast">{toast}</div>}
                    
                    <div className="bg-black/80 backdrop-blur-md sticky top-0 z-20 border-b border-zinc-800">
                        <div className="px-4 pt-3 pb-2 flex items-center gap-2">
                            <IconWrapper name="map" className="text-sky-400 w-4 h-4" />
                            <h1 className="text-sm font-bold text-zinc-100 tracking-wide">Á´ãÂ±±ÈªëÈÉ® Êô∫ËÉΩË°åËªçÂúñ V59</h1>
                        </div>
                        <div className="flex overflow-x-auto no-scrollbar gap-2 px-4 pb-3 snap-x">
                            {ITINERARY_DATA.map((d, idx) => (
                                <button key={d.id} onClick={() => setCurrentDayIdx(idx)}
                                    className={`flex-shrink-0 px-4 py-1.5 rounded-lg flex flex-col items-center min-w-[60px] transition-all snap-center border ${currentDayIdx === idx ? 'bg-sky-500/10 text-sky-400 border-sky-500/50 shadow-glow-primary' : 'bg-zinc-900 border-zinc-800 text-zinc-500 hover:text-zinc-300'}`}>
                                    <span className="text-[9px] font-bold uppercase tracking-wider">Day {idx + 1}</span>
                                    <span className="text-sm font-bold">{d.date.split('-')[2]}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    <div key={day.id} className="flex-1 px-4 py-5 overflow-y-auto pb-24 animate-card">
                        <div className="flex justify-between items-start mb-6">
                            <div>
                                <div className="flex items-center gap-2 mb-1.5">
                                    <span className="text-[10px] font-bold text-zinc-900 bg-sky-400 px-2 py-0.5 rounded uppercase tracking-wider">{day.city}</span>
                                    {day.note && <span className="text-[10px] font-bold text-amber-400 border border-amber-400/30 px-2 py-0.5 rounded bg-amber-400/10">{day.note}</span>}
                                </div>
                                <h2 className="text-2xl font-bold text-zinc-50">{day.title}</h2>
                                <p className="text-xs text-zinc-400 mt-1 font-mono">{day.date.replace(/-/g, '/')} {day.displayDate.split(' ')[1]}</p>
                            </div>
                            <WeatherWidget lat={day.lat} lon={day.lon} date={day.date} />
                        </div>

                        {day.planB && (
                            <button onClick={togglePlan} className={`w-full mb-6 flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-bold transition-all border ${isPlanB ? 'bg-amber-500/10 text-amber-400 border-amber-500/30 shadow-glow-accent' : 'bg-zinc-900 text-zinc-400 border-zinc-800 hover:bg-zinc-800'}`}>
                                <IconWrapper name="refresh-cw" className="w-4 h-4" />
                                {isPlanB ? 'È°ØÁ§∫‰∏≠ÔºöÈõ®Â§©ÂÇôÊ°à' : 'ÂàáÊèõÂÇôÊ°à (Plan B)'}
                            </button>
                        )}

                        <div className="space-y-4 relative pl-[14px]">
                            <div className="absolute left-[27px] top-4 bottom-4 w-[2px] bg-zinc-800 rounded-full"></div>
                            {currentPlan.map((item, i) => (
                                <div key={i} className="relative pl-8">
                                    <div className={`absolute left-[-14px] top-0 w-8 h-8 rounded-full flex items-center justify-center z-10 border-[3px] border-[#09090b] ${
                                        item.type === 'task' ? 'bg-sky-500 text-zinc-950' : 
                                        item.type === 'alert' ? 'bg-red-500 text-white' : 
                                        item.type === 'food' ? 'bg-orange-500 text-white' : 
                                        item.type === 'festival' ? 'bg-amber-400 text-zinc-950' : 
                                        item.highlight ? 'bg-zinc-200 text-zinc-900' : 'bg-zinc-800 text-zinc-400'
                                    }`}>
                                        <IconWrapper name={item.type === 'food' ? 'utensils' : item.type === 'transport' ? 'train-front' : item.type === 'festival' ? 'flame' : item.type === 'alert' ? 'triangle-alert' : 'map-pin'} className="w-3.5 h-3.5" />
                                    </div>
                                    <div className={`app-card p-4 ${item.type === 'task' ? 'task-box' : item.type === 'alert' ? 'alert-box' : item.type === 'food' ? 'food-box' : item.type === 'festival' ? 'festival-box' : ''}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <span className={`text-[11px] font-bold font-mono px-1.5 py-0.5 rounded ${item.type === 'food' ? 'bg-orange-500/20 text-orange-400' : 'bg-zinc-800 text-zinc-400'}`}>{item.time.split(' - ')[0]}</span>
                                            {item.type !== 'flight' && <a href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.title + ' ' + day.city)}`} target="_blank" className="bg-zinc-800 p-1.5 rounded-lg border border-zinc-700 text-sky-400"><IconWrapper name="map" className="w-4 h-4" /></a>}
                                        </div>
                                        <h3 className={`text-base font-bold mb-1.5 ${item.type === 'food' ? 'text-orange-400' : item.type === 'festival' ? 'text-amber-400' : item.highlight ? 'text-sky-300' : 'text-zinc-100'}`}>{item.title}</h3>
                                        <div className="text-sm text-zinc-400 leading-relaxed whitespace-pre-line">{item.detail}</div>
                                        
                                        {item.recs && (
                                            <div className="mt-3 space-y-2 border-t border-zinc-800 pt-3">
                                                <div className="text-[10px] font-bold text-zinc-500 flex items-center gap-1 mb-1"><IconWrapper name="sparkles" className="w-3 h-3 text-orange-400" /> AI Êé®Ëñ¶</div>
                                                {item.recs.map((rec, rIdx) => (
                                                    <div key={rIdx} className="bg-black/30 p-2 rounded-lg border border-zinc-800/50 flex justify-between items-center">
                                                        <div><div className="font-bold text-xs text-zinc-200">{rec.n}</div><div className="text-[10px] text-zinc-500">{rec.t} ¬∑ {rec.desc}</div></div>
                                                        <a href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(rec.n + ' ' + day.city)}`} target="_blank" className="text-zinc-600 hover:text-orange-400"><IconWrapper name="navigation" className="w-4 h-4" /></a>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                        {item.address && <div className="mt-3 bg-black/40 p-2 rounded border border-zinc-800 flex justify-between items-center"><span className="text-xs text-zinc-500 font-mono truncate">{item.address}</span><CopyButton text={item.address} onCopy={() => showToast('Âú∞ÂùÄÂ∑≤Ë§áË£Ω')} /></div>}
                                        {item.cost && <div className="mt-2 inline-flex items-center gap-1.5 bg-emerald-500/10 px-2 py-1 rounded text-[11px] font-bold text-emerald-400 border border-emerald-500/20"><IconWrapper name="banknote" className="w-3 h-3" /> {item.cost}</div>}
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="flex justify-between mt-8">
                             <button onClick={handlePrevDay} disabled={currentDayIdx===0} className="px-4 py-2 rounded-lg bg-zinc-900 border border-zinc-800 text-zinc-400 disabled:opacity-30 text-sm font-bold shadow-sm hover:bg-zinc-800">‚Üê Ââç‰∏ÄÂ§©</button>
                             <button onClick={handleNextDay} disabled={currentDayIdx===ITINERARY_DATA.length-1} className="px-4 py-2 rounded-lg bg-sky-500 text-zinc-950 disabled:opacity-50 text-sm font-bold shadow-glow-primary hover:bg-sky-400">‰∏ã‰∏ÄÂ§© ‚Üí</button>
                        </div>
                    </div>
                </div>
            );
        };

        const CouponView = () => {
            const [filter, setFilter] = useState("ALL");
            const [selectedCoupon, setSelectedCoupon] = useState(null);
            return (
                <div className="h-full overflow-y-auto pb-24 px-4 py-6">
                     <header className="mb-6"><h2 className="text-2xl font-bold text-zinc-50 mb-4 px-2">ÂÑ™ÊÉ†Âà∏</h2>
                        <div className="flex gap-2 overflow-x-auto no-scrollbar px-2">
                            {['ALL', 'Ëó•Â¶ù', 'ÁôæË≤®', 'ÈõªÂô®', 'ÂÖçÁ®ÖÂ∫ó', 'ÈõúË≤®'].map(tag => (
                                <button key={tag} onClick={() => setFilter(tag)} className={`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap border ${filter === tag ? 'bg-sky-500 text-zinc-950 border-sky-400' : 'bg-zinc-900 text-zinc-400 border-zinc-800'}`}>{tag}</button>
                            ))}
                        </div>
                    </header>
                    <div className="grid grid-cols-2 gap-3 px-2">
                        {COUPONS_DATA.filter(c => filter === 'ALL' || c.tags.includes(filter)).map((coupon, idx) => (
                            <div key={idx} onClick={() => setSelectedCoupon(coupon)} className="app-card flex flex-col p-4 cursor-pointer group h-[110px] justify-between">
                                <div><div className="text-[9px] font-bold text-sky-400 bg-sky-900/30 px-1.5 py-0.5 rounded uppercase w-fit mb-1">{coupon.tags[0]}</div>
                                <h3 className="font-bold text-zinc-100 text-base leading-tight truncate">{coupon.name}</h3></div>
                                <div className="text-emerald-400 font-bold text-xs mt-1 truncate">{coupon.discount}</div>
                            </div>
                        ))}
                    </div>
                    {selectedCoupon && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm" onClick={() => setSelectedCoupon(null)}>
                            <div className="bg-zinc-900 rounded-2xl w-full max-w-sm overflow-hidden border border-zinc-700" onClick={e => e.stopPropagation()}>
                                <div className="p-4 border-b border-zinc-800 flex justify-between bg-zinc-950"><h3 className="font-bold text-lg">{selectedCoupon.name}</h3><button onClick={() => setSelectedCoupon(null)}><IconWrapper name="x" className="w-5 h-5" /></button></div>
                                <div className="p-4 bg-white min-h-[200px] flex items-center justify-center"><img src={selectedCoupon.final_url} className="max-w-full h-auto object-contain max-h-[50vh]" /></div>
                                <div className="p-5 flex flex-col items-center bg-zinc-950"><p className="text-emerald-400 font-bold text-xl mb-1">{selectedCoupon.discount}</p><p className="text-xs text-zinc-500 mb-5">ÊúüÈôêÔºö{selectedCoupon.expiry}</p><a href={selectedCoupon.final_url} target="_blank" className="w-full py-3 rounded-xl bg-sky-500 text-zinc-950 font-bold text-center">ÂÑ≤Â≠òÂúñÁâá / ÈñãÂïüÂ§ßÂúñ</a></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const App = () => {
            const [tab, setTab] = useState('itinerary');
            return (
                <div className="h-[100dvh] flex flex-col bg-[#09090b]">
                    <div className="flex-1 overflow-hidden relative">
                        {tab === 'itinerary' && <ItineraryView />}
                        {tab === 'coupons' && <CouponView />}
                    </div>
                    <nav className="bg-[#18181b]/90 backdrop-blur-lg border-t border-zinc-800 pb-safe z-50">
                        <div className="flex justify-around items-center h-16 max-w-md mx-auto px-2">
                            {[{ id: 'itinerary', icon: 'map', label: 'Ë°åËªçÂúñ' }, { id: 'coupons', icon: 'ticket', label: 'ÂÑ™ÊÉ†' }].map(item => (
                                <button key={item.id} onClick={() => setTab(item.id)} className={`flex flex-col items-center gap-1 w-20 transition-all ${tab === item.id ? 'text-sky-400 scale-105' : 'text-zinc-500 hover:text-zinc-400'}`}>
                                    <IconWrapper name={item.icon} className={`w-5 h-5 ${tab === item.id ? 'stroke-[2.5px]' : 'stroke-[2px]'}`} />
                                    <span className="text-[10px] font-bold">{item.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>
                </div>
            );
        };
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
